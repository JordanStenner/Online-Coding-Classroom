{% extends "lesson/base.html" %}
{% load static %}
{% block customlinks %}

    <script src="{% static 'lesson/codemirror/lib/codemirror.js' %}"></script>
    <link rel="stylesheet" href="{% static 'lesson/codemirror/lib/codemirror.css' %}">
    <!--<script src="{% static 'lesson/codemirror/mode/javascript/javascript.js' %}"></script> ADD IN LANGUAGE MODE HERE FOR EACH PAGE -->
    {% if lesson.language.language_name == "javascript"%}
        <script src="{% static 'lesson/codemirror/mode/javascript/javascript.js' %}"></script>
    {% endif %}
    {% if lesson.language.language_name == "python"%}
        <script src="{% static 'lesson/codemirror/mode/python/python.js' %}"></script>
    {% endif %}
    {% if lesson.language.language_name == "html_and_css"%}
        <script src="{% static 'lesson/codemirror/mode/htmlmixed/htmlmixed.js' %}"></script>
    {% endif %}
    {% if lesson.language.language_name is None %}
        <script src="{% static 'lesson/codemirror/mode/javascript/javascript.js' %}"></script>
        <script src="{% static 'lesson/codemirror/mode/markdown/markdown.js' %}"></script>
    {% endif %}
    <script src="{% static 'lesson/codemirror/addon/edit/matchbrackets.js' %}"></script>
    <script src="{% static 'lesson/codemirror/addon/edit/closebrackets.js' %}"></script>
    <link href="{% static 'lesson/codemirror/theme/dracula.css' %}" rel="stylesheet"/>
    <script src="{% static 'lesson/editor.js' %}"></script>
    <!--<script src="{% static 'lesson/run_code.js' %}"></script>-->
    <link rel="stylesheet" href="{% static 'lesson/lesson.css' %}">


    <script>
    $(function(){
        $(".alert").alert();

        $("#run_code").click(function(){
            var editor_input = $(".CodeMirror")[0].CodeMirror;
            var untrusted_code = editor_input.getValue();
            console.log("Button works");

            $.ajax({
                url: '{% url 'get_code' %}',
                data: {
                    'untrustedCode': untrusted_code
                },
                dataType: 'json',
                success: function (data) {
                    let result = data["output"];
                    var editor_output = $(".CodeMirror")[1].CodeMirror;
                    editor_output.setValue(result);
                    check_result(result);
                }
            });
        });

        function check_result(result){
            switch(result){
                case "Hello World!":
                    $("#success_modal").modal("show");
                    $("#next_lesson").show();//Remove if using modal
                    console.log("Correct output");
                    break;
                case "Hello World":
                    console.log("Double-check what your variable is storing");
                    break;
                default:
                    console.log("Output incorrect");
            }
        }
    });
    </script>
{% endblock customlinks %}
{% block content %}


<div class="container">
    {% csrf_token %}
    <div id="top">
        {% if lesson.lesson_title %}
        <h1 id="lesson_title">{{ lesson.lesson_title }}</h1>
        {% else %}
        <h1 id="lesson_title">Lesson Title Placeholder</h1>
        {% endif %}
        <a href="#hint_modal" role="button" data-toggle="modal"><img id="hint-img" src="{% static 'lesson/images/hint.png' %}"></a>
    </div>
    <div class="container_editor">  
        <textarea id="editor_input" name="editor_input">
function variable_exercise(){
    //Write variable here

    //Return the variable here
}
        </textarea>
    </div>
    <div class="container_output">
        <textarea id="editor_output">
        </textarea>
    </div>
    <div class="container_content">
        <h4>Lesson Objective:</h4>
        <p id="lesson_description">
            {% if lesson.lesson_description %}
            {{ lesson.lesson_description }}
            {% else %}
            Lesson Description Placeholder
            {% endif %}
        </p>
    </div>
    <button id="run_code" class="btn btn-secondary">Run Code</button>
    <button id="next_lesson" class="btn btn-success">Next Lesson</button>
</div>

<!-- Hint Modal -->
<div class="modal fade" id="hint_modal" tabindex="-1" role="dialog" aria-labelledby="hint_modal_label" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="hint_modal_label">
            {% if lessonHint.hint_title %}
                {{ lessonHint.hint_title }}
            {% else %}
                Lesson Hint Placeholder
            {% endif %}
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        {% if lessonHint.hint_description %}
            {{ lessonHint.hint_description }}
        {% else %}
            Hint Description Placeholder
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div id="success_modal" class="modal fade" data-backdrop='static' data-keyboard='false'>
	<div class="modal-dialog modal-success">
		<div class="modal-content">
			<div class="modal-header justify-content-center">
				<div class="icon">
					<i class="material-icons">&#xE876;</i>
				</div>
			</div>
			<div class="modal-body text-center">
				<h4>Lesson Complete!</h4>	
				<p>Move on to the next lesson!</p>
				<button class="btn btn-success"><span>Next Lesson</span> <i class="material-icons">&#xE5C8;</i></button><!-- This to link to next lesson -->
			</div>
		</div>
	</div>
</div>     
{% endblock %}